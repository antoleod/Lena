<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Appli de L√©na - Bienvenue !</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/login.css">
    <link rel="stylesheet" href="../css/feedback-system.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@600;700;900&family=Nunito:wght@600;800&display=swap" rel="stylesheet">
    <link rel="manifest" href="../manifest.json">
    <meta name="application-name" content="L√©na-App">
    <meta name="apple-mobile-web-app-title" content="L√©na-App">
    <link rel="icon" href="../assets/iconos/icon-32.png" sizes="32x32">
    <link rel="shortcut icon" href="../assets/iconos/icon-32.png">
    <link rel="apple-touch-icon" href="../assets/iconos/icon-180.png">
</head>
<body class="login-body">
    <div class="login-orb login-orb--pink"></div>
    <div class="login-orb login-orb--mint"></div>
    <div class="login-orb login-orb--lavender"></div>

    <div id="login-container" role="main">
        <div class="login-header">
            <div class="login-header__card">
                <span class="login-badge" data-i18n="loginBadge">‚ú® Choisis ton avatar ‚ú®</span>
                <div class="login-lang">
                    <label class="login-lang__label" for="languageSelect" data-i18n="languageLabel">Langue</label>
                    <select id="languageSelect" class="login-lang__select" data-language-select data-i18n-aria="languageSelectAria"></select>
                </div>
                <div class="login-headline">
                    <h1 class="login-title" data-i18n="loginTitle">Bienvenue dans ton aventure magique</h1>
                    <p class="login-steps" data-i18n="loginSteps">S√©lectionne un avatar, choisis ta couleur pr√©f√©r√©e et √©cris ton pr√©nom.</p>
                </div>
            </div>

            <div class="selection-preview" aria-live="polite">
                <div class="selection-preview__avatar" aria-hidden="true">
                    <img id="selected-avatar-preview" src="" alt="">
                    <span id="selected-avatar-placeholder" class="selection-preview__placeholder">‚ú®</span>
                </div>
                <div class="selection-preview__details">
                    <span class="selection-preview__label" data-i18n="selectedAvatarLabel">Avatar choisi</span>
                    <span class="selection-preview__value" id="selected-avatar-name" data-i18n="selectedAvatarPlaceholder">Choisis ton avatar</span>
                </div>
                <div class="selection-preview__details">
                    <span class="selection-preview__label" data-i18n="selectedNameLabel">Ton prAcnom</span>
                    <span class="selection-preview__value" id="selected-player-name" data-i18n="selectedNamePlaceholder">A%cris ton prAcnom</span>
                </div>
            </div>
        </div>

        <section class="login-section" aria-labelledby="avatar-section-title">
            <header class="section-header">
                <h2 id="avatar-section-title" data-i18n="avatarSectionTitle">Avatars d√©licieux</h2>
            </header>
            <div id="avatar-selection" role="listbox" aria-label="Choisis ton avatar prAcfAcrAc" data-i18n-aria="avatarListLabel">
                <button class="avatar-option" type="button" data-avatar-id="licorne" data-avatar-name="Licorne Arc-en-ciel" data-avatar-icon="../assets/avatars/licorne.svg" data-avatar-color="#ffc6ff" aria-label="Licorne arc-en-ciel">
                    <span class="avatar-emoji">ü¶Ñ</span>
                    <span class="avatar-label">Licorne</span>
                </button>
                <button class="avatar-option" type="button" data-avatar-id="renard" data-avatar-name="Renard malicieux" data-avatar-icon="../assets/avatars/renard.svg" data-avatar-color="#ffd6a5" aria-label="Renard malicieux">
                    <span class="avatar-emoji">ü¶ä</span>
                    <span class="avatar-label">Renard</span>
                </button>
                <button class="avatar-option" type="button" data-avatar-id="panda" data-avatar-name="Panda c√¢lin" data-avatar-icon="../assets/avatars/panda.svg" data-avatar-color="#caffbf" aria-label="Panda c√¢lin">
                    <span class="avatar-emoji">üêº</span>
                    <span class="avatar-label">Panda</span>
                </button>
                <button class="avatar-option" type="button" data-avatar-id="hibou" data-avatar-name="Hibou sage" data-avatar-icon="../assets/avatars/hibou.svg" data-avatar-color="#a0c4ff" aria-label="Hibou sage">
                    <span class="avatar-emoji">ü¶â</span>
                    <span class="avatar-label">Hibou</span>
                </button>
                <button class="avatar-option" type="button" data-avatar-id="fraise" data-avatar-name="Fraise p√©tillante" data-avatar-icon="../assets/avatars/fraise.svg" data-avatar-color="#ffadad" aria-label="Fraise p√©tillante">
                    <span class="avatar-emoji">üçì</span>
                    <span class="avatar-label">Fraise</span>
                </button>
                <button class="avatar-option" type="button" data-avatar-id="pomme" data-avatar-name="Pomme brillante" data-avatar-icon="../assets/avatars/pomme.svg" data-avatar-color="#ffadad" aria-label="Pomme brillante">
                    <span class="avatar-emoji">üçé</span>
                    <span class="avatar-label">Pomme</span>
                </button>
                <button class="avatar-option" type="button" data-avatar-id="banane" data-avatar-name="Banane rigolote" data-avatar-icon="../assets/avatars/banane.svg" data-avatar-color="#fdffb6" aria-label="Banane rigolote">
                    <span class="avatar-emoji">üçå</span>
                    <span class="avatar-label">Banane</span>
                </button>
                <button class="avatar-option" type="button" data-avatar-id="ananas" data-avatar-name="Ananas disco" data-avatar-icon="../assets/avatars/ananas.svg" data-avatar-color="#ffd6a5" aria-label="Ananas disco">
                    <span class="avatar-emoji">üçç</span>
                    <span class="avatar-label">Ananas</span>
                </button>
            </div>
        </section>



        <section class="login-section" aria-labelledby="name-section-title">
           <div class="name-input-wrapper">
                <span class="name-icon" aria-hidden="true">üìù</span>
                <input type="text" id="name-input" data-i18n-placeholder="namePlaceholder" data-i18n-aria="nameAria" placeholder="√âcris ton pr√©nom ici..." aria-label="√âcris ton pr√©nom" autocapitalize="words" maxlength="12" inputmode="text">
            </div>
        </section>

        <section class="login-section" aria-labelledby="color-section-title">
            <header class="section-header">
                <h2 id="color-section-title" data-i18n="colorSectionTitle">Choisis ta couleur pr√©f√©r√©e</h2>
            </header>
            <div id="color-selection" role="radiogroup" aria-label="Choisis ta couleur prAcfAcrAce" data-i18n-aria="colorListLabel">
                <button class="color-option" type="button" style="--color-base: #ffadad;" data-color="#ffadad" data-tooltip="üå∏ Rose pastel" aria-label="Rose pastel"></button>
                <button class="color-option" type="button" style="--color-base: #ffd6a5;" data-color="#ffd6a5" data-tooltip="üçë Abricot doux" aria-label="Abricot doux"></button>
                <button class="color-option" type="button" style="--color-base: #fdffb6;" data-color="#fdffb6" data-tooltip="üçã Citron l√©ger" aria-label="Citron l√©ger"></button>
                <button class="color-option" type="button" style="--color-base: #caffbf;" data-color="#caffbf" data-tooltip="üåø Menthe fra√Æche" aria-label="Menthe fra√Æche"></button>
                <button class="color-option" type="button" style="--color-base: #9bf6ff;" data-color="#9bf6ff" data-tooltip="üåä Oc√©an clair" aria-label="Oc√©an clair"></button>
                <button class="color-option" type="button" style="--color-base: #a0c4ff;" data-color="#a0c4ff" data-tooltip="‚òÅÔ∏è Ciel calme" aria-label="Ciel calme"></button>
                <button class="color-option" type="button" style="--color-base: #bdb2ff;" data-color="#bdb2ff" data-tooltip="üíú Lavande" aria-label="Lavande"></button>
                <button class="color-option" type="button" style="--color-base: #ffc6ff;" data-color="#ffc6ff" data-tooltip="üçì Framboise l√©g√®re" aria-label="Framboise l√©g√®re"></button>
                <button class="color-option color-option-white" type="button" style="--color-base: #ffffff;" data-color="#ffffff" data-tooltip="‚ú® Blanc magique" aria-label="Blanc magique"></button>
            </div>
        </section>

        <button id="login-btn" class="btn" type="button">
            <span class="rocket-icon" aria-hidden="true">üöÄ</span>
            <span class="btn-label" data-i18n="loginButton">Entrer dans le monde de L√©na</span>
        </button>

        <p id="login-error" class="login-error" role="alert" aria-live="assertive" hidden></p>
    </div>

    <div class="login-wand" aria-hidden="true">ü™Ñ</div>
    <div class="login-fireflies" aria-hidden="true">
        <span></span><span></span><span></span><span></span>
    </div>
    <script src="../js/feedbackSystem.js" defer></script>
    <script src="../js/avatarData.js"></script>
    <script src="../js/storage.js"></script>
    <script src="../js/i18n.js" defer></script>
    <script src="../js/login.js"></script>
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('../service-worker.js')
                .then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);

                    // Listen for updates to the service worker.
                    if (registration.waiting) {
                        // A new SW is waiting to activate
                        notifyUpdate(registration);
                    }

                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    // New update available
                                    notifyUpdate(registration);
                                }
                            }
                        });
                    });

                    // Ensure that when the user confirms update we tell the SW to skipWaiting
                    function notifyUpdate(reg) {
                        const updateBannerId = 'sw-update-banner';
                        if (document.getElementById(updateBannerId)) return; // already shown

                        const banner = document.createElement('div');
                        banner.id = updateBannerId;
                        banner.style.position = 'fixed';
                        banner.style.left = '0';
                        banner.style.right = '0';
                        banner.style.bottom = '0';
                        banner.style.background = '#fff8e1';
                        banner.style.borderTop = '1px solid #ffd54f';
                        banner.style.padding = '12px';
                        banner.style.display = 'flex';
                        banner.style.justifyContent = 'space-between';
                        banner.style.alignItems = 'center';
                        banner.style.zIndex = '9999';

                        const text = document.createElement('div');
                        text.textContent = 'Une nouvelle version est disponible.';
                        const btn = document.createElement('button');
                        btn.textContent = 'Mettre √† jour';
                        btn.style.marginLeft = '12px';
                        btn.className = 'btn';

                        btn.addEventListener('click', () => {
                            if (!reg.waiting) return;
                            // Send message to SW to skipWaiting
                            reg.waiting.postMessage('skipWaiting');
                        });

                        banner.appendChild(text);
                        banner.appendChild(btn);
                        document.body.appendChild(banner);
                    }

                    // When the new service worker activates, reload to take control
                    let refreshing = false;
                    navigator.serviceWorker.addEventListener('controllerchange', () => {
                        if (refreshing) return;
                        refreshing = true;
                        window.location.reload();
                    });

                })
                .catch(error => {
                    console.error('Service Worker registration failed:', error);
                });
        });
    }
</script>
</body>
</html>





