<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les Sorci√®res - Le Po√®me Magique</title>
    <link rel="stylesheet" href="../css/header-footer.css">
    <link rel="stylesheet" href="../css/les-sorcieres.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&family=Fredoka:wght@400;700&display=swap" rel="stylesheet">
    <script>
    (function(){
      const blockedEndpoints = [/events\.launchdarkly\.com/i];
      const matchesBlocked = (url) => {
        if (!url) return false;
        try { return blockedEndpoints.some((pattern) => pattern.test(String(url))); }
        catch { return false; }
      };
      const createStubResponse = () => new Response('', { status: 204, statusText: 'Local Dev Stub' });

      const originalFetch = window.fetch;
      if (typeof originalFetch === 'function') {
        window.fetch = function(input, init) {
          try {
            const url = typeof input === 'string' ? input : (input && input.url);
            if (matchesBlocked(url)) {
              console.info('[LaunchDarkly] fetch blocked in local mode:', url);
              return Promise.resolve(createStubResponse());
            }
          } catch {}
          return originalFetch.apply(this, arguments);
        };
      }

      const originalBeacon = navigator.sendBeacon ? navigator.sendBeacon.bind(navigator) : null;
      if (originalBeacon) {
        navigator.sendBeacon = function(url, data) {
          if (matchesBlocked(url)) {
            console.info('[LaunchDarkly] beacon blocked in local mode:', url);
            return true;
          }
          return originalBeacon(url, data);
        };
      }

      const OriginalXHR = window.XMLHttpRequest;
      if (OriginalXHR) {
        const originalOpen = OriginalXHR.prototype.open;
        OriginalXHR.prototype.open = function(method, url) {
          this.__ldBlocked = matchesBlocked(url);
          return originalOpen.apply(this, arguments);
        };
      }
    })();
    </script>
    <link rel="manifest" href="../manifest.json">
</head>
<body>
    <div id="game-container">
        <header>
            <h1>Les Sorci√®res - Associe les √âmojis !</h1>
        </header>
        <main id="game-area">
            <div id="poem-container">
                <!-- Les vers du po√®me seront inject√©s ici par JavaScript -->
            </div>
            <div id="progress-container">
                <div id="progress-bar-container">
                    <div id="progress-bar"></div>
                </div>
                <span id="progress-label">0%</span>
            </div>
            <div id="emoji-bank">
                <!-- Les emojis disponibles seront inject√©s ici -->
            </div>
            <button id="verify-button" class="hidden">V√©rifier</button>
        </main>
        <div id="success-message" class="hidden">
            <div class="success-content">
                <h2>Bravo, petite sorci√®re !</h2>
                <p>Tu connais le po√®me des sorci√®res par c≈ìur ! üßô‚Äç‚ôÄÔ∏èüí´</p>
                <button id="restart-button">Rejouer</button>
            </div>
        </div>
    </div>
    <div id="confetti-container"></div>

    <script src="../js/audioManager.js"></script>
    <script src="../js/storage.js"></script>
    <script src="../games/les-sorcieres.js"></script>
</body>
</html>